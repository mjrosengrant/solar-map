<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8"> 
    <style>
       #map {
        height: 500px;
        width: 100%;
       }
    </style>
    <script>
      var selectedArea;
      function initMap() {
        // Initialize map over Boston.
        var bostonCoordinates = {lat: 42.3583333, lng: -71.0602778};
        var mapDiv = document.getElementById('map')
        var mapOptions = {
          zoom: 14,
          center: bostonCoordinates,
          mapTypeId: 'satellite',
        }

        map = new google.maps.Map(
            mapDiv,
            mapOptions
        );

        // set up drawing manager for creating polygons.
        drawingManager = new google.maps.drawing.DrawingManager({
          drawingModes: ['rectangle', 'polygon'],
          map: map
        });

        // Upon completing a new overlay, remove any existing ones.
        google.maps.event.addListener(drawingManager, 'overlaycomplete', function(e) {
          if (selectedArea) {
            // Delete the existing overlay.
            selectedArea.overlay.setMap(null)
          }
          selectedArea = e
          area = getArea(selectedArea)
          alert(area); 
        });
      }

      function getArea(selectedArea) {
        rec = new google.maps.Rectangle(selectedArea.overlay)
        // corner1Lat = selectedArea.overlay.bounds.f.b
        // corner1Lng = selectedArea.overlay.bounds.b.b
        
        // corner2Lat = selectedArea.overlay.bounds.f.f
        // corner2Lng = selectedArea.overlay.bounds.b.f

        neLat = rec.getBounds().getNorthEast().lat()
        neLng = rec.getBounds().getNorthEast().lng()

        swLat = rec.getBounds().getSouthWest().lat()
        swLng = rec.getBounds().getSouthWest().lng() 
        
        mvcArray = new google.maps.MVCArray([
          {
            'lat': neLat,
            'lng': neLng
          },
          {
            'lat': swLat,
            'lng': swLng
          }
        ])
        return google.maps.geometry.spherical.computeArea(mvcArray)
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACeOVdalXmjRb_RL2DYqU3H6LUowBETac&callback=initMap&libraries=drawing,geometry">
    </script>

    <!-- Load Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="js/solar_map.js"></script>
  </head>
  <body>
    <h3>Solar Calculator</h3>
    <div id="map"></div>
    <div class="container">
        <div class='row'>
          <div class='col-xs-12'>
                <div id="map-toolbox">
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      <input id="id_draw-toggle" type="checkbox" aria-label="Checkbox for following text input">
                      Check to draw solar area  
                    </div>
                  </div>
                </div>
              </div>
          </div>
        </div>
        <div class='row'>
          <div class="col-xs-12 col-sm-6">
            <div class="text-center">
              <h1>Location Info</h1> 
            </div>
            <div id="location-data">
                Coordinates
            </div>
          </div>
          <div class="col-xs-12 col-sm-6">
            <div class="text-center">
              <h1>Solar Data</h1>
            </div>
            <div class="solar-data">
              Select an area to view solar availability.
            </div>
          </div>
        </div>
    </div>
  </body>
</html>